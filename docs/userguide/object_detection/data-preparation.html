
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <title>Data Preparation Â· GitBook</title>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.0">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="advanced-usage.html" />
    
    
    <link rel="prev" href="./" />
    

    <script src="../turi/js/jquery/jquery-2.1.3.min.js"></script>
    <script src="../turi/js/d3/d3.min.js"></script>
    <script src="../supervised-learning/images/random-utils.js"></script>
    <script src="../supervised-learning/images/plotting-utils.js"></script>

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../sframe/">
            
                <a href="../sframe/">
            
                    
                    Working with data
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../sframe/tabular-data.html">
            
                <a href="../sframe/tabular-data.html">
            
                    
                    Tabular data
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1" data-path="../sframe/sframe-intro.html">
            
                <a href="../sframe/sframe-intro.html">
            
                    
                    Loading and Saving
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2" data-path="../sframe/data-manipulation.html">
            
                <a href="../sframe/data-manipulation.html">
            
                    
                    Data Manipulation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.3" data-path="../data_formats_and_sources/sql_integration.html">
            
                <a href="../data_formats_and_sources/sql_integration.html">
            
                    
                    SQL Databases
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../sgraph/sgraph.html">
            
                <a href="../sgraph/sgraph.html">
            
                    
                    Graph data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../text/analysis.html">
            
                <a href="../text/analysis.html">
            
                    
                    Text data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../vis/">
            
                <a href="../vis/">
            
                    
                    Visualization
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.4.1" data-path="../vis/gallery.html">
            
                <a href="../vis/gallery.html">
            
                    
                    Example Gallery
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.2" data-path="../vis/use_cases.html">
            
                <a href="../vis/use_cases.html">
            
                    
                    Sample Use Cases
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../applications/">
            
                <a href="../applications/">
            
                    
                    Task focused toolkits
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../recommender/">
            
                <a href="../recommender/">
            
                    
                    Recommender Systems
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" data-path="../recommender/using-trained-models.html">
            
                <a href="../recommender/using-trained-models.html">
            
                    
                    Using models
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.2" data-path="../recommender/choosing-a-model.html">
            
                <a href="../recommender/choosing-a-model.html">
            
                    
                    Choosing a model
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.3" data-path="../recommender/coreml-deployment.html">
            
                <a href="../recommender/coreml-deployment.html">
            
                    
                    Deployment to Core ML
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../image_classifier/">
            
                <a href="../image_classifier/">
            
                    
                    Image Classification
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1" data-path="../image_classifier/advanced-usage.html">
            
                <a href="../image_classifier/advanced-usage.html">
            
                    
                    Advanced Usage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.2" data-path="../image_classifier/how-it-works.html">
            
                <a href="../image_classifier/how-it-works.html">
            
                    
                    How it works
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.3" data-path="../image_classifier/export-coreml.html">
            
                <a href="../image_classifier/export-coreml.html">
            
                    
                    Deployment to Core ML
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../drawing_classifier/">
            
                <a href="../drawing_classifier/">
            
                    
                    Drawing Classification
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.3.1" data-path="../drawing_classifier/how-it-works.html">
            
                <a href="../drawing_classifier/how-it-works.html">
            
                    
                    How it works
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.2" data-path="../drawing_classifier/data-preparation.html">
            
                <a href="../drawing_classifier/data-preparation.html">
            
                    
                    Data Preparation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.3" data-path="../drawing_classifier/export-coreml.html">
            
                <a href="../drawing_classifier/export-coreml.html">
            
                    
                    Deployment to Core ML
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.4" data-path="../drawing_classifier/advanced-usage.html">
            
                <a href="../drawing_classifier/advanced-usage.html">
            
                    
                    Advanced Usage
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../sound_classifier/">
            
                <a href="../sound_classifier/">
            
                    
                    Sound Classification
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.4.1" data-path="../sound_classifier/how-it-works.html">
            
                <a href="../sound_classifier/how-it-works.html">
            
                    
                    How it works
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.2" data-path="../sound_classifier/advanced-usage.html">
            
                <a href="../sound_classifier/advanced-usage.html">
            
                    
                    Advanced Usage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.3" data-path="../sound_classifier/export-coreml.html">
            
                <a href="../sound_classifier/export-coreml.html">
            
                    
                    Deployment to Core ML
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../image_similarity/">
            
                <a href="../image_similarity/">
            
                    
                    Image Similarity
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.5.1" data-path="../image_similarity/export-coreml.html">
            
                <a href="../image_similarity/export-coreml.html">
            
                    
                    Deployment to Core ML
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="./">
            
                <a href="./">
            
                    
                    Object Detection
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.3.6.1" data-path="data-preparation.html">
            
                <a href="data-preparation.html">
            
                    
                    Data Preparation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6.2" data-path="advanced-usage.html">
            
                <a href="advanced-usage.html">
            
                    
                    Advanced Usage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6.3" data-path="export-coreml.html">
            
                <a href="export-coreml.html">
            
                    
                    Deployment to Core ML
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6.4" data-path="how-it-works.html">
            
                <a href="how-it-works.html">
            
                    
                    How it works
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="../one_shot_object_detection/">
            
                <a href="../one_shot_object_detection/">
            
                    
                    One-Shot Object Detection
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="../style_transfer/">
            
                <a href="../style_transfer/">
            
                    
                    Style Transfer
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.8.1" data-path="../style_transfer/how-it-works.html">
            
                <a href="../style_transfer/how-it-works.html">
            
                    
                    How it works
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8.2" data-path="../style_transfer/export-coreml.html">
            
                <a href="../style_transfer/export-coreml.html">
            
                    
                    Deployment to Core ML
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.9" data-path="../activity_classifier/">
            
                <a href="../activity_classifier/">
            
                    
                    Activity Classification
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.9.1" data-path="../activity_classifier/data-preparation.html">
            
                <a href="../activity_classifier/data-preparation.html">
            
                    
                    Data Preparation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.9.2" data-path="../activity_classifier/advanced-usage.html">
            
                <a href="../activity_classifier/advanced-usage.html">
            
                    
                    Advanced Usage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.9.3" data-path="../activity_classifier/export_coreml.html">
            
                <a href="../activity_classifier/export_coreml.html">
            
                    
                    Deployment to Core ML
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.9.4" data-path="../activity_classifier/how-it-works.html">
            
                <a href="../activity_classifier/how-it-works.html">
            
                    
                    How it works
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.10" data-path="../text_classifier/">
            
                <a href="../text_classifier/">
            
                    
                    Text Classifier
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../modeling-data/">
            
                <a href="../modeling-data/">
            
                    
                    Machine learning essentials
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../supervised-learning/classifier.html">
            
                <a href="../supervised-learning/classifier.html">
            
                    
                    Classification
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1.1" data-path="../supervised-learning/boosted_trees_classifier.html">
            
                <a href="../supervised-learning/boosted_trees_classifier.html">
            
                    
                    Boosted Trees Classifier
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.2" data-path="../supervised-learning/decision_tree_classifier.html">
            
                <a href="../supervised-learning/decision_tree_classifier.html">
            
                    
                    Decision Tree Classifier
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.3" data-path="../supervised-learning/logistic-regression.html">
            
                <a href="../supervised-learning/logistic-regression.html">
            
                    
                    Logistic Regression
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.4" data-path="../supervised-learning/knn_classifier.html">
            
                <a href="../supervised-learning/knn_classifier.html">
            
                    
                    Nearest Neighbor Classifier
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.5" data-path="../supervised-learning/random_forest_classifier.html">
            
                <a href="../supervised-learning/random_forest_classifier.html">
            
                    
                    Random Forest Classifier
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.6" data-path="../supervised-learning/svm.html">
            
                <a href="../supervised-learning/svm.html">
            
                    
                    SVM
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.7" data-path="../supervised-learning/export-coreml.html">
            
                <a href="../supervised-learning/export-coreml.html">
            
                    
                    Deployment to Core ML
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../clustering/">
            
                <a href="../clustering/">
            
                    
                    Clustering
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.2.1" data-path="../clustering/kmeans.html">
            
                <a href="../clustering/kmeans.html">
            
                    
                    KMeans
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.2" data-path="../clustering/dbscan.html">
            
                <a href="../clustering/dbscan.html">
            
                    
                    DBSCAN
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../graph_analytics/">
            
                <a href="../graph_analytics/">
            
                    
                    Graph analytics
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../nearest_neighbors/nearest_neighbors.html">
            
                <a href="../nearest_neighbors/nearest_neighbors.html">
            
                    
                    Nearest neighbors
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../supervised-learning/regression.html">
            
                <a href="../supervised-learning/regression.html">
            
                    
                    Regression
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.5.1" data-path="../supervised-learning/boosted_trees_regression.html">
            
                <a href="../supervised-learning/boosted_trees_regression.html">
            
                    
                    Boosted Trees Regression
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.2" data-path="../supervised-learning/decision_tree_regression.html">
            
                <a href="../supervised-learning/decision_tree_regression.html">
            
                    
                    Decision Tree Regression
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.3" data-path="../supervised-learning/linear-regression.html">
            
                <a href="../supervised-learning/linear-regression.html">
            
                    
                    Linear Regression
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.4" data-path="../supervised-learning/random_forest_regression.html">
            
                <a href="../supervised-learning/random_forest_regression.html">
            
                    
                    Random Forest Regression
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.5" data-path="../supervised-learning/export-coreml.html">
            
                <a href="../supervised-learning/export-coreml.html">
            
                    
                    Deployment to Core ML
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../text/">
            
                <a href="../text/">
            
                    
                    Text analysis
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../evaluation/">
            
                <a href="../evaluation/">
            
                    
                    Evaluating models
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../evaluation/regression.html">
            
                <a href="../evaluation/regression.html">
            
                    
                    Regression metrics
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../evaluation/classification.html">
            
                <a href="../evaluation/classification.html">
            
                    
                    Classification metrics
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../conclusion.html">
            
                <a href="../conclusion.html">
            
                    
                    Additional Resources
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../cpp.html">
            
                <a href="../cpp.html">
            
                    
                    C++ API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../datasets.html">
            
                <a href="../datasets.html">
            
                    
                    Dataset Disclaimer
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Data Preparation</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="ig02-data-preparation"><a name="ig02-data-preparation" class="plugin-anchor" href="#ig02-data-preparation"><i class="fa fa-link" aria-hidden="true"></i></a>IG02 Data Preparation</h1><p>In this section, we will show you how to download a publicly available dataset
and load it into an SFrame. This will allow you to try out the Object Detection
toolkit for yourself. To get this dataset into the format expected by our
toolkit, we will rely on many useful SFrame functions.</p><p><em>Note: Please make sure that you have Turi Create 4.3 or above for these steps</em></p><p>The dataset that we will use is <a href="https://lear.inrialpes.fr/people/marszalek/data/ig02/" target="_blank">INRIA Annotations for Graz-02
(IG02)</a><sup><a href="#fn_1" id="reffn_1">1</a></sup><sup><a href="#fn_2" id="reffn_2">2</a></sup>. Our goal is to
make a detector that can spot bikes and cars. Open a new terminal window and run the following commands:</p><pre><code>$ mkdir -p ~/Downloads/ig02
$ cd ~/Downloads/ig02
$ curl https://lear.inrialpes.fr/people/marszalek/data/ig02/ig02-v1.0-bikes.zip &gt; bikes.zip
$ curl https://lear.inrialpes.fr/people/marszalek/data/ig02/ig02-v1.0-cars.zip &gt; cars.zip
$ unzip bikes.zip
$ mv readme.txt readme-bikes.txt
$ unzip cars.zip
$ rm bikes.zip cars.zip </code></pre>
<p>Now, you should have the following file structure:</p><pre><code>~/Downloads/ig02/
    bikes_info.txt
    bikes_test.txt
    bikes_train.txt
    bikes/
        bike_001.image.png
        bike_001.mask.0.png
        bike_001.mask.1.png
        bike_001.mask.2.png
        bike_001.mask.3.png
        bike_002.image.png
        ...
    cars_info.txt
    cars_test.txt
    cars_train.txt
    cars/
        carsgraz_001.image.png
        carsgraz_001.mask.0.png
        carsgraz_002.image.png
        ...
    readme.txt
    readme2.txt</code></pre>
<p>This dataset contains masks marking the exact pixels belonging to each object
instance. Each image may have several masks to indicate the presence of
multiple objects. Red pixels indicate object presence and green indicate
presence but with <a href="https://en.wikipedia.org/wiki/Occultation" target="_blank">occlusion</a>. For
object detection, we will convert this richly annotated data to bounding boxes.
Here is a snippet to turn this into an SFrame:</p><pre><code class="lang-python"><span class="hljs-keyword">import</span> turicreate <span class="hljs-keyword">as</span> tc
<span class="hljs-keyword">import</span> os

<span class="hljs-comment"># Change if applicable</span>
ig02_path = <span class="hljs-string">&apos;Downloads/ig02&apos;</span>

<span class="hljs-comment"># Load all images in random order</span>
raw_sf = tc.image_analysis.load_images(ig02_path, recursive=<span class="hljs-keyword">True</span>,
                                       random_order=<span class="hljs-keyword">True</span>)

<span class="hljs-comment"># Split file names so that we can determine what kind of image each row is</span>
<span class="hljs-comment"># E.g. bike_005.mask.0.png -&gt; [&apos;bike_005&apos;, &apos;mask&apos;]</span>
info = raw_sf[<span class="hljs-string">&apos;path&apos;</span>].apply(<span class="hljs-keyword">lambda</span> path: os.path.basename(path).split(<span class="hljs-string">&apos;.&apos;</span>)[:<span class="hljs-number">2</span>])

<span class="hljs-comment"># Rename columns to &apos;name&apos; and &apos;type&apos;</span>
info = info.unpack().rename({<span class="hljs-string">&apos;X.0&apos;</span>: <span class="hljs-string">&apos;name&apos;</span>, <span class="hljs-string">&apos;X.1&apos;</span>: <span class="hljs-string">&apos;type&apos;</span>})

<span class="hljs-comment"># Add to our main SFrame</span>
raw_sf = raw_sf.add_columns(info)

<span class="hljs-comment"># Extract label (e.g. &apos;bike&apos;) from name (e.g. &apos;bike_003&apos;)</span>
raw_sf[<span class="hljs-string">&apos;label&apos;</span>] = raw_sf[<span class="hljs-string">&apos;name&apos;</span>].apply(<span class="hljs-keyword">lambda</span> name: name.split(<span class="hljs-string">&apos;_&apos;</span>)[<span class="hljs-number">0</span>])

<span class="hljs-comment"># Original path no longer needed</span>
<span class="hljs-keyword">del</span> raw_sf[<span class="hljs-string">&apos;path&apos;</span>]

<span class="hljs-comment"># Split into images and masks</span>
sf_images = raw_sf[raw_sf[<span class="hljs-string">&apos;type&apos;</span>] == <span class="hljs-string">&apos;image&apos;</span>]
sf_masks = raw_sf[raw_sf[<span class="hljs-string">&apos;type&apos;</span>] == <span class="hljs-string">&apos;mask&apos;</span>]

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">mask_to_bbox_coordinates</span><span class="hljs-params">(img)</span>:</span>
    <span class="hljs-string">&quot;&quot;&quot;
    Takes a tc.Image of a mask and returns a dictionary representing bounding
    box coordinates: e.g. {&apos;x&apos;: 100, &apos;y&apos;: 120, &apos;width&apos;: 80, &apos;height&apos;: 120}
    &quot;&quot;&quot;</span>
    <span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
    mask = img.pixel_data
    <span class="hljs-keyword">if</span> mask.max() == <span class="hljs-number">0</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">None</span>
    <span class="hljs-comment"># Take max along both x and y axis, and find first and last non-zero value</span>
    x0, x1 = np.where(mask.max(<span class="hljs-number">0</span>))[<span class="hljs-number">0</span>][[<span class="hljs-number">0</span>, <span class="hljs-number">-1</span>]]
    y0, y1 = np.where(mask.max(<span class="hljs-number">1</span>))[<span class="hljs-number">0</span>][[<span class="hljs-number">0</span>, <span class="hljs-number">-1</span>]]

    <span class="hljs-keyword">return</span> {<span class="hljs-string">&apos;x&apos;</span>: (x0 + x1) / <span class="hljs-number">2</span>, <span class="hljs-string">&apos;width&apos;</span>: (x1 - x0),
            <span class="hljs-string">&apos;y&apos;</span>: (y0 + y1) / <span class="hljs-number">2</span>, <span class="hljs-string">&apos;height&apos;</span>: (y1 - y0)}

<span class="hljs-comment"># Convert masks to bounding boxes (drop masks that did not contain bounding box)</span>
sf_masks[<span class="hljs-string">&apos;coordinates&apos;</span>] = sf_masks[<span class="hljs-string">&apos;image&apos;</span>].apply(mask_to_bbox_coordinates)

<span class="hljs-comment"># There can be empty masks (which returns None), so let&apos;s get rid of those</span>
sf_masks = sf_masks.dropna(<span class="hljs-string">&apos;coordinates&apos;</span>)

<span class="hljs-comment"># Combine label and coordinates into a bounding box dictionary</span>
sf_masks = sf_masks.pack_columns([<span class="hljs-string">&apos;label&apos;</span>, <span class="hljs-string">&apos;coordinates&apos;</span>],
                                 new_column_name=<span class="hljs-string">&apos;bbox&apos;</span>, dtype=dict)

<span class="hljs-comment"># Combine bounding boxes of the same &apos;name&apos; into lists</span>
sf_annotations = sf_masks.groupby(<span class="hljs-string">&apos;name&apos;</span>,
                                 {<span class="hljs-string">&apos;annotations&apos;</span>: tc.aggregate.CONCAT(<span class="hljs-string">&apos;bbox&apos;</span>)})

<span class="hljs-comment"># Join annotations with the images. Note, some images do not have annotations,</span>
<span class="hljs-comment"># but we still want to keep them in the dataset. This is why it is important to</span>
<span class="hljs-comment"># a LEFT join.</span>
sf = sf_images.join(sf_annotations, on=<span class="hljs-string">&apos;name&apos;</span>, how=<span class="hljs-string">&apos;left&apos;</span>)

<span class="hljs-comment"># The LEFT join fills missing matches with None, so we replace these with empty</span>
<span class="hljs-comment"># lists instead using fillna.</span>
sf[<span class="hljs-string">&apos;annotations&apos;</span>] = sf[<span class="hljs-string">&apos;annotations&apos;</span>].fillna([])

<span class="hljs-comment"># Remove unnecessary columns</span>
<span class="hljs-keyword">del</span> sf[<span class="hljs-string">&apos;type&apos;</span>]

<span class="hljs-comment"># Save SFrame</span>
sf.save(<span class="hljs-string">&apos;ig02.sframe&apos;</span>)</code></pre>
<p>There are many useful data preparation tips in these steps, so we encourage you
to go through it in an interactive session or a notebook so that you can
inspect the outcome of each command.</p><p>After you have run this script, you should have <code>ig02.sframe</code> in your current
directory. This SFrame can be used as described in the <a href="./">Object detection user
guide</a>.</p><p>Alternately, if you don&apos;t have access to bitmasks and you&apos;re using an image 
annotation tool like the one 
<a href="https://github.com/sgp715/simple_image_annotator" target="_blank">here</a>, here is a code snippet
(thanks to <a href="https://github.com/Kurry" target="_blank">@Kurry</a>) 
that would convert the CSV you get out of the annotator into an SFrame.</p><pre><code class="lang-python"><span class="hljs-keyword">import</span> turicreate <span class="hljs-keyword">as</span> tc
<span class="hljs-keyword">import</span> os

IMAGES_DIR = <span class="hljs-string">&apos;images&apos;</span> <span class="hljs-comment"># Change if applicable</span>
csv_path = <span class="hljs-string">&apos;out.csv&apos;</span> <span class="hljs-comment"># assumes CSV column format is image,id,name,xMin,xMax,yMin,yMax</span>
csv_sf = tc.SFrame.read_csv(csv_path)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">row_to_bbox_coordinates</span><span class="hljs-params">(row)</span>:</span>
    <span class="hljs-string">&quot;&quot;&quot;
    Takes a row and returns a dictionary representing bounding
    box coordinates:  (center_x, center_y, width, height)  e.g. {&apos;x&apos;: 100, &apos;y&apos;: 120, &apos;width&apos;: 80, &apos;height&apos;: 120}
    &quot;&quot;&quot;</span>
    <span class="hljs-keyword">return</span> {<span class="hljs-string">&apos;x&apos;</span>: row[<span class="hljs-string">&apos;xMin&apos;</span>] + (row[<span class="hljs-string">&apos;xMax&apos;</span>] - row[<span class="hljs-string">&apos;xMin&apos;</span>])/<span class="hljs-number">2</span>, 
            <span class="hljs-string">&apos;width&apos;</span>: (row[<span class="hljs-string">&apos;xMax&apos;</span>] - row[<span class="hljs-string">&apos;xMin&apos;</span>]),
            <span class="hljs-string">&apos;y&apos;</span>: row[<span class="hljs-string">&apos;yMin&apos;</span>] + (row[<span class="hljs-string">&apos;yMax&apos;</span>] - row[<span class="hljs-string">&apos;yMin&apos;</span>])/<span class="hljs-number">2</span>, 
            <span class="hljs-string">&apos;height&apos;</span>: (row[<span class="hljs-string">&apos;yMax&apos;</span>] - row[<span class="hljs-string">&apos;yMin&apos;</span>])}

csv_sf[<span class="hljs-string">&apos;coordinates&apos;</span>] = csv_sf.apply(row_to_bbox_coordinates)
<span class="hljs-comment"># delete no longer needed columns</span>
<span class="hljs-keyword">del</span> csv_sf[<span class="hljs-string">&apos;id&apos;</span>], csv_sf[<span class="hljs-string">&apos;xMin&apos;</span>], csv_sf[<span class="hljs-string">&apos;xMax&apos;</span>], csv_sf[<span class="hljs-string">&apos;yMin&apos;</span>], csv_sf[<span class="hljs-string">&apos;yMax&apos;</span>]
<span class="hljs-comment"># rename columns</span>
csv_sf = csv_sf.rename({<span class="hljs-string">&apos;name&apos;</span>: <span class="hljs-string">&apos;label&apos;</span>, <span class="hljs-string">&apos;image&apos;</span>: <span class="hljs-string">&apos;name&apos;</span>})

<span class="hljs-comment"># Load all images in random order</span>
sf_images = tc.image_analysis.load_images(IMAGES_DIR, recursive=<span class="hljs-keyword">True</span>,
    random_order=<span class="hljs-keyword">True</span>)

<span class="hljs-comment"># Split path to get filename</span>
info = sf_images[<span class="hljs-string">&apos;path&apos;</span>].apply(<span class="hljs-keyword">lambda</span> path: os.path.basename(path).split(<span class="hljs-string">&apos;/&apos;</span>)[:<span class="hljs-number">1</span>])

<span class="hljs-comment"># Rename columns to &apos;name&apos;</span>
info = info.unpack().rename({<span class="hljs-string">&apos;X.0&apos;</span>: <span class="hljs-string">&apos;name&apos;</span>})

<span class="hljs-comment"># Add to our main SFrame</span>
sf_images = sf_images.add_columns(info)

<span class="hljs-comment"># Original path no longer needed</span>
<span class="hljs-keyword">del</span> sf_images[<span class="hljs-string">&apos;path&apos;</span>]

<span class="hljs-comment"># Combine label and coordinates into a bounding box dictionary</span>
csv_sf = csv_sf.pack_columns([<span class="hljs-string">&apos;label&apos;</span>, <span class="hljs-string">&apos;coordinates&apos;</span>], new_column_name=<span class="hljs-string">&apos;bbox&apos;</span>, dtype=dict)

<span class="hljs-comment"># Combine bounding boxes of the same &apos;name&apos; into lists</span>
sf_annotations = csv_sf.groupby(<span class="hljs-string">&apos;name&apos;</span>, 
    {<span class="hljs-string">&apos;annotations&apos;</span>: tc.aggregate.CONCAT(<span class="hljs-string">&apos;bbox&apos;</span>)})

<span class="hljs-comment"># Join annotations with the images. Note, some images do not have annotations,</span>
<span class="hljs-comment"># but we still want to keep them in the dataset. This is why it is important to</span>
<span class="hljs-comment"># a LEFT join.</span>
sf = sf_images.join(sf_annotations, on=<span class="hljs-string">&apos;name&apos;</span>, how=<span class="hljs-string">&apos;left&apos;</span>)

<span class="hljs-comment"># The LEFT join fills missing matches with None, so we replace these with empty</span>
<span class="hljs-comment"># lists instead using fillna.</span>
sf[<span class="hljs-string">&apos;annotations&apos;</span>] = sf[<span class="hljs-string">&apos;annotations&apos;</span>].fillna([])

<span class="hljs-comment"># Save SFrame</span>
sf.save(<span class="hljs-string">&apos;ig02.sframe&apos;</span>)</code></pre>
<h2 id="references"><a name="references" class="plugin-anchor" href="#references"><i class="fa fa-link" aria-hidden="true"></i></a>References</h2><p>The <a href="lear.inrialpes.fr/people/marszalek/data/ig02">IG02</a> dataset is described
further in:</p><blockquote id="fn_1">
<sup>1</sup>. Marcin Marsza&#x142;ek and Cordelia Schmid. <a href="http://lear.inrialpes.fr/pubs/2007/MS07a/" target="_blank">Accurate Object Localization with Shape Masks.</a> IEEE Conference on Computer Vision &amp; Pattern Recognition, 2007.<a href="#reffn_1" title="Jump back to footnote [1] in the text."> &#x21A9;</a>
</blockquote>
<blockquote id="fn_2">
<sup>2</sup>. A. Opelt, A. Pinz, M. Fussenegger, P. Auer. <a href="http://www.emt.tugraz.at/~opelt/download_data/Generic_object_recognition_with_boosting.pdf" target="_blank">Generic Object Recognition with Boosting.</a> IEEE Transactions on Pattern Recognition and Machine Intelligence (PAMI), Vol.28, No. 3, March 2006.<a href="#reffn_2" title="Jump back to footnote [2] in the text."> &#x21A9;</a>
</blockquote>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="./" class="navigation navigation-prev " aria-label="Previous page: Object Detection">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="advanced-usage.html" class="navigation navigation-next " aria-label="Next page: Advanced Usage">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Data Preparation","level":"1.3.6.1","depth":3,"next":{"title":"Advanced Usage","level":"1.3.6.2","depth":3,"path":"object_detection/advanced-usage.md","ref":"object_detection/advanced-usage.md","articles":[]},"previous":{"title":"Object Detection","level":"1.3.6","depth":2,"path":"object_detection/README.md","ref":"object_detection/README.md","articles":[{"title":"Data Preparation","level":"1.3.6.1","depth":3,"path":"object_detection/data-preparation.md","ref":"object_detection/data-preparation.md","articles":[]},{"title":"Advanced Usage","level":"1.3.6.2","depth":3,"path":"object_detection/advanced-usage.md","ref":"object_detection/advanced-usage.md","articles":[]},{"title":"Deployment to Core ML","level":"1.3.6.3","depth":3,"path":"object_detection/export-coreml.md","ref":"object_detection/export-coreml.md","articles":[]},{"title":"How it works","level":"1.3.6.4","depth":3,"path":"object_detection/how-it-works.md","ref":"object_detection/how-it-works.md","articles":[]}]},"dir":"ltr"},"config":{"gitbook":"3.2.0","theme":"default","variables":{},"plugins":["collapsible-menu@1.0.2","anchors@0.5.0","mathjax"],"pluginsConfig":{"collapsible-menu":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"fontSettings":{"theme":"white","family":"sans","size":2},"highlight":{},"mathjax":{"forceSVG":false,"version":"2.6-latest"},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"anchors":{}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"object_detection/data-preparation.md","mtime":"2020-05-01T01:06:35.572Z","type":"markdown"},"gitbook":{"version":"3.2.0","time":"2020-10-09T21:45:22.325Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-collapsible-menu/plugin.js"></script>
        
    
        
        <script src="https://cdn.mathjax.org/mathjax/2.6-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-mathjax/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

