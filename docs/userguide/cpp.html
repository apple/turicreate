
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <title>C++ API Â· GitBook</title>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.0">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="datasets.html" />
    
    
    <link rel="prev" href="conclusion.html" />
    

    <script src="turi/js/jquery/jquery-2.1.3.min.js"></script>
    <script src="turi/js/d3/d3.min.js"></script>
    <script src="supervised-learning/images/random-utils.js"></script>
    <script src="supervised-learning/images/plotting-utils.js"></script>

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="sframe/">
            
                <a href="sframe/">
            
                    
                    Working with data
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="sframe/tabular-data.html">
            
                <a href="sframe/tabular-data.html">
            
                    
                    Tabular data
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1" data-path="sframe/sframe-intro.html">
            
                <a href="sframe/sframe-intro.html">
            
                    
                    Loading and Saving
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2" data-path="sframe/data-manipulation.html">
            
                <a href="sframe/data-manipulation.html">
            
                    
                    Data Manipulation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.3" data-path="data_formats_and_sources/sql_integration.html">
            
                <a href="data_formats_and_sources/sql_integration.html">
            
                    
                    SQL Databases
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="sgraph/sgraph.html">
            
                <a href="sgraph/sgraph.html">
            
                    
                    Graph data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="text/analysis.html">
            
                <a href="text/analysis.html">
            
                    
                    Text data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="vis/">
            
                <a href="vis/">
            
                    
                    Visualization
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.4.1" data-path="vis/gallery.html">
            
                <a href="vis/gallery.html">
            
                    
                    Example Gallery
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.2" data-path="vis/use_cases.html">
            
                <a href="vis/use_cases.html">
            
                    
                    Sample Use Cases
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="applications/">
            
                <a href="applications/">
            
                    
                    Task focused toolkits
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="recommender/">
            
                <a href="recommender/">
            
                    
                    Recommender Systems
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" data-path="recommender/using-trained-models.html">
            
                <a href="recommender/using-trained-models.html">
            
                    
                    Using models
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.2" data-path="recommender/choosing-a-model.html">
            
                <a href="recommender/choosing-a-model.html">
            
                    
                    Choosing a model
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.3" data-path="recommender/coreml-deployment.html">
            
                <a href="recommender/coreml-deployment.html">
            
                    
                    Deployment to Core ML
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="image_classifier/">
            
                <a href="image_classifier/">
            
                    
                    Image Classification
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1" data-path="image_classifier/advanced-usage.html">
            
                <a href="image_classifier/advanced-usage.html">
            
                    
                    Advanced Usage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.2" data-path="image_classifier/how-it-works.html">
            
                <a href="image_classifier/how-it-works.html">
            
                    
                    How it works
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.3" data-path="image_classifier/export-coreml.html">
            
                <a href="image_classifier/export-coreml.html">
            
                    
                    Deployment to Core ML
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="drawing_classifier/">
            
                <a href="drawing_classifier/">
            
                    
                    Drawing Classification
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.3.1" data-path="drawing_classifier/how-it-works.html">
            
                <a href="drawing_classifier/how-it-works.html">
            
                    
                    How it works
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.2" data-path="drawing_classifier/data-preparation.html">
            
                <a href="drawing_classifier/data-preparation.html">
            
                    
                    Data Preparation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.3" data-path="drawing_classifier/export-coreml.html">
            
                <a href="drawing_classifier/export-coreml.html">
            
                    
                    Deployment to Core ML
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.4" data-path="drawing_classifier/advanced-usage.html">
            
                <a href="drawing_classifier/advanced-usage.html">
            
                    
                    Advanced Usage
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="sound_classifier/">
            
                <a href="sound_classifier/">
            
                    
                    Sound Classification
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.4.1" data-path="sound_classifier/how-it-works.html">
            
                <a href="sound_classifier/how-it-works.html">
            
                    
                    How it works
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.2" data-path="sound_classifier/advanced-usage.html">
            
                <a href="sound_classifier/advanced-usage.html">
            
                    
                    Advanced Usage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.3" data-path="sound_classifier/export-coreml.html">
            
                <a href="sound_classifier/export-coreml.html">
            
                    
                    Deployment to Core ML
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="image_similarity/">
            
                <a href="image_similarity/">
            
                    
                    Image Similarity
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.5.1" data-path="image_similarity/export-coreml.html">
            
                <a href="image_similarity/export-coreml.html">
            
                    
                    Deployment to Core ML
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="object_detection/">
            
                <a href="object_detection/">
            
                    
                    Object Detection
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.6.1" data-path="object_detection/data-preparation.html">
            
                <a href="object_detection/data-preparation.html">
            
                    
                    Data Preparation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6.2" data-path="object_detection/advanced-usage.html">
            
                <a href="object_detection/advanced-usage.html">
            
                    
                    Advanced Usage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6.3" data-path="object_detection/export-coreml.html">
            
                <a href="object_detection/export-coreml.html">
            
                    
                    Deployment to Core ML
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6.4" data-path="object_detection/how-it-works.html">
            
                <a href="object_detection/how-it-works.html">
            
                    
                    How it works
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="one_shot_object_detection/">
            
                <a href="one_shot_object_detection/">
            
                    
                    One-Shot Object Detection
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="style_transfer/">
            
                <a href="style_transfer/">
            
                    
                    Style Transfer
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.8.1" data-path="style_transfer/how-it-works.html">
            
                <a href="style_transfer/how-it-works.html">
            
                    
                    How it works
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8.2" data-path="style_transfer/export-coreml.html">
            
                <a href="style_transfer/export-coreml.html">
            
                    
                    Deployment to Core ML
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.9" data-path="activity_classifier/">
            
                <a href="activity_classifier/">
            
                    
                    Activity Classification
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.9.1" data-path="activity_classifier/data-preparation.html">
            
                <a href="activity_classifier/data-preparation.html">
            
                    
                    Data Preparation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.9.2" data-path="activity_classifier/advanced-usage.html">
            
                <a href="activity_classifier/advanced-usage.html">
            
                    
                    Advanced Usage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.9.3" data-path="activity_classifier/export_coreml.html">
            
                <a href="activity_classifier/export_coreml.html">
            
                    
                    Deployment to Core ML
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.9.4" data-path="activity_classifier/how-it-works.html">
            
                <a href="activity_classifier/how-it-works.html">
            
                    
                    How it works
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.10" data-path="text_classifier/">
            
                <a href="text_classifier/">
            
                    
                    Text Classifier
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="modeling-data/">
            
                <a href="modeling-data/">
            
                    
                    Machine learning essentials
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="supervised-learning/classifier.html">
            
                <a href="supervised-learning/classifier.html">
            
                    
                    Classification
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1.1" data-path="supervised-learning/boosted_trees_classifier.html">
            
                <a href="supervised-learning/boosted_trees_classifier.html">
            
                    
                    Boosted Trees Classifier
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.2" data-path="supervised-learning/decision_tree_classifier.html">
            
                <a href="supervised-learning/decision_tree_classifier.html">
            
                    
                    Decision Tree Classifier
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.3" data-path="supervised-learning/logistic-regression.html">
            
                <a href="supervised-learning/logistic-regression.html">
            
                    
                    Logistic Regression
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.4" data-path="supervised-learning/knn_classifier.html">
            
                <a href="supervised-learning/knn_classifier.html">
            
                    
                    Nearest Neighbor Classifier
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.5" data-path="supervised-learning/random_forest_classifier.html">
            
                <a href="supervised-learning/random_forest_classifier.html">
            
                    
                    Random Forest Classifier
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.6" data-path="supervised-learning/svm.html">
            
                <a href="supervised-learning/svm.html">
            
                    
                    SVM
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.7" data-path="supervised-learning/export-coreml.html">
            
                <a href="supervised-learning/export-coreml.html">
            
                    
                    Deployment to Core ML
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="clustering/">
            
                <a href="clustering/">
            
                    
                    Clustering
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.2.1" data-path="clustering/kmeans.html">
            
                <a href="clustering/kmeans.html">
            
                    
                    KMeans
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.2" data-path="clustering/dbscan.html">
            
                <a href="clustering/dbscan.html">
            
                    
                    DBSCAN
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="graph_analytics/">
            
                <a href="graph_analytics/">
            
                    
                    Graph analytics
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="nearest_neighbors/nearest_neighbors.html">
            
                <a href="nearest_neighbors/nearest_neighbors.html">
            
                    
                    Nearest neighbors
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="supervised-learning/regression.html">
            
                <a href="supervised-learning/regression.html">
            
                    
                    Regression
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.5.1" data-path="supervised-learning/boosted_trees_regression.html">
            
                <a href="supervised-learning/boosted_trees_regression.html">
            
                    
                    Boosted Trees Regression
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.2" data-path="supervised-learning/decision_tree_regression.html">
            
                <a href="supervised-learning/decision_tree_regression.html">
            
                    
                    Decision Tree Regression
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.3" data-path="supervised-learning/linear-regression.html">
            
                <a href="supervised-learning/linear-regression.html">
            
                    
                    Linear Regression
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.4" data-path="supervised-learning/random_forest_regression.html">
            
                <a href="supervised-learning/random_forest_regression.html">
            
                    
                    Random Forest Regression
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.5" data-path="supervised-learning/export-coreml.html">
            
                <a href="supervised-learning/export-coreml.html">
            
                    
                    Deployment to Core ML
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="text/">
            
                <a href="text/">
            
                    
                    Text analysis
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="evaluation/">
            
                <a href="evaluation/">
            
                    
                    Evaluating models
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="evaluation/regression.html">
            
                <a href="evaluation/regression.html">
            
                    
                    Regression metrics
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="evaluation/classification.html">
            
                <a href="evaluation/classification.html">
            
                    
                    Classification metrics
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="conclusion.html">
            
                <a href="conclusion.html">
            
                    
                    Additional Resources
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.6.1" data-path="cpp.html">
            
                <a href="cpp.html">
            
                    
                    C++ API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="datasets.html">
            
                <a href="datasets.html">
            
                    
                    Dataset Disclaimer
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >C++ API</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="using-the-c-api-experimental"><a name="using-the-c-api-experimental" class="plugin-anchor" href="#using-the-c-api-experimental"><i class="fa fa-link" aria-hidden="true"></i></a>Using the C++ API (Experimental)</h1><p>Turi Create provides a C++ API to enable embedding into other applications or services, as a way to deploy models for inference, or to enable training in embedded scenarios where there is no Python interpreter. This consists of a set of headers; when those headers are consumed, the resulting library or application can be linked against the <code>libunity</code> provided by the <code>turicreate</code> package.</p><p>The <a href="https://apple.github.io/turicreate/docs/cpp/" target="_blank">API documentation for the C++ API</a> provides a more complete reference of available functions, classes, and methods. Note that this API is not stable and may change at any time; plan to pin a particular version of Turi Create to your application or service to make use of this API.</p><h5 id="caveats"><a name="caveats" class="plugin-anchor" href="#caveats"><i class="fa fa-link" aria-hidden="true"></i></a>Caveats</h5><ul><li>This technique is experimental and depends on internal APIs within Turi Create that may change over time. The C++ API is not API-stable.
</li>
<li>In order to link properly, some build flags must be shared between Turi Create and your project.
</li>
<li>Not all functionality in the Turi Create Python package is available in the C++ API.
</li></ul>
<h5 id="setup"><a name="setup" class="plugin-anchor" href="#setup"><i class="fa fa-link" aria-hidden="true"></i></a>Setup</h5><p>Using the C++ API requires building Turi Create from source, starting with a clone of the <a href="git@github.com:apple/turicreate.git">repository</a>. You should consider checking out a particular <a href="https://github.com/apple/turicreate/releases" target="_blank">release</a> in order to keep API stability as you proceed (the API may change in master). Before proceeding to use the C++ API, run <code>./configure</code> to set up the build system for the project, and run <code>make -j8</code> from within <code>release/src/unity</code> to build the library artifacts that your application will depend on.</p><p>Currently, the C++ API is not packaged for easy consumption outside of the Turi Create Python package. As a result, some care is needed when compiling and linking against Turi Create. This may cause compatibility issues since those compilation and linking flags may not be compatible with flags used elsewhere. Required compilation flags for your project include:</p><ul><li><code>-std=c++11</code> - some headers exposed by Turi Create require the use of C++11 or later.
</li>
<li><code>-stdlib=libc++</code> - may be needed on macOS (probably not on Linux).
</li>
<li><p>Assuming <path_to_tc> refers to the location where you cloned the Turi Create repository, the following directories must be added to the include paths with <code>-I</code>, and to the link paths with <code>-L</code>:</path_to_tc></p><ul><li><code>-I&lt;PATH_TO_TC&gt;/turicreate/src</code>
</li>
<li><code>-I&lt;PATH_TO_TC&gt;/turicreate/src/external</code>
</li>
<li><code>-I&lt;PATH_TO_TC&gt;/turicreate/deps/local/include</code>
</li>
<li><code>-I&lt;PATH_TO_TC&gt;/turicreate/src/external/armadillo/include</code>
</li>
<li><code>-L&lt;PATH_TO_TC&gt;/turicreate/release/src/unity</code>
</li></ul>
</li>
<li><p>Depending on your compiler toolchain, the following defines may be needed (note: these are autodetected for Turi Create itself with <code>./configure</code>, but the values must be passed on to your own build process):</p></li>
<li><code>-DHASH_FOR_UINT128_DEFINED</code> - set this if your compiler toolchain supports <code>unsigned __int128</code>.
</li>
<li><code>-DHASH_FOR_INT128_DEFINED</code> - set this if your compiler toolchain supports <code>__int128</code>.
</li>
<li><code>-lunity_shared</code> to link against <code>libunity_shared.so</code>.
</li>
<li><code>&lt;PATH_TO_TC&gt;/turicreate/release/src/model_server/libunity.a</code> to statically link libunity.a into your project. Note that this is needed in addition to the dynamic library listed above.
</li></ul>
<h5 id="example-make-predictions-in-c-from-a-model-trained-in-python"><a name="example-make-predictions-in-c-from-a-model-trained-in-python" class="plugin-anchor" href="#example-make-predictions-in-c-from-a-model-trained-in-python"><i class="fa fa-link" aria-hidden="true"></i></a>Example: make predictions in C++ from a model trained in Python</h5><p>Let&apos;s assume we&apos;re starting with the model from the introductory example in the <a href="https://github.com/apple/turicreate/blob/3490286b27ff5d79cb90d09fe026d5671ce990c7/userguide/supervised-learning/boosted_trees_classifier.md#gradient-boosted-regression-trees" target="_blank">boosted trees classifier</a> section of the user guide. The model is available as <a href="https://github.com/apple/turicreate/files/1654991/mushroom.tcmodel.zip" target="_blank">mushroom.tcmodel.zip</a>.</p><p>To make predictions from this model in Python, you could run:</p><pre><code class="lang-python"><span class="hljs-keyword">import</span> turicreate <span class="hljs-keyword">as</span> tc
data =  tc.SFrame.read_csv(<span class="hljs-string">&apos;turicreate/lfs/datasets/xgboost/mushroom.csv&apos;</span>)
model = tc.load_model(<span class="hljs-string">&apos;mushroom.tcmodel&apos;</span>)
data[<span class="hljs-number">0</span>]</code></pre>
<pre><code>{&apos;bruises?&apos;: &apos;t&apos;,
 &apos;cap-color&apos;: &apos;n&apos;,
 &apos;cap-shape&apos;: &apos;x&apos;,
 &apos;cap-surface&apos;: &apos;s&apos;,
 &apos;gill-attachment&apos;: &apos;f&apos;,
 &apos;gill-color&apos;: &apos;k&apos;,
 &apos;gill-size&apos;: &apos;n&apos;,
 &apos;gill-spacing&apos;: &apos;c&apos;,
 &apos;habitat&apos;: &apos;u&apos;,
 &apos;label&apos;: &apos;c&apos;,
 &apos;odor&apos;: &apos;p&apos;,
 &apos;population&apos;: &apos;s&apos;,
 &apos;ring-number&apos;: &apos;o&apos;,
 &apos;ring-type&apos;: &apos;p&apos;,
 &apos;spore-print-color&apos;: &apos;k&apos;,
 &apos;stalk-color-above-ring&apos;: &apos;w&apos;,
 &apos;stalk-color-below-ring&apos;: &apos;w&apos;,
 &apos;stalk-root&apos;: &apos;e&apos;,
 &apos;stalk-shape&apos;: &apos;e&apos;,
 &apos;stalk-surface-above-ring&apos;: &apos;s&apos;,
 &apos;stalk-surface-below-ring&apos;: &apos;s&apos;,
 &apos;veil-color&apos;: &apos;w&apos;,
 &apos;veil-type&apos;: &apos;p&apos;}</code></pre>
<pre><code class="lang-python">model.predict_topk(data[<span class="hljs-number">0</span>], k=<span class="hljs-number">2</span>, output_type=<span class="hljs-string">&apos;probability&apos;</span>)</code></pre>
<pre><code>Columns:
    id    int
    class    int
    probability    float

Rows: 2

Data:
+----+-------+---------------+
| id | class |  probability  |
+----+-------+---------------+
| 0  |   1   | 0.57558375597 |
| 0  |   0   | 0.42441624403 |
+----+-------+---------------+
[2 rows x 3 columns]</code></pre>
<p>In C++, the equivalent code would be (minus the CSV parsing):</p><pre><code class="lang-cpp"><span class="hljs-comment">// standard C++ includes</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span>

<span class="hljs-comment">// Turi Create includes</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;core/logging/assertions.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;core/logging/logger.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unity/lib/unity_global.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unity/server/registration.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;toolkits/supervised_learning/boosted_trees.hpp&gt;</span></span>

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span> </span>{
  <span class="hljs-comment">// set up registry of named functions and models</span>
  <span class="hljs-comment">// used for rehydrating saved models</span>
  <span class="hljs-keyword">auto</span> fn_reg = turi::toolkit_function_registry();
  turi::register_functions(fn_reg);
  <span class="hljs-keyword">auto</span> class_reg = turi::toolkit_class_registry();
  turi::register_models(class_reg);

  <span class="hljs-comment">// create a global context</span>
  <span class="hljs-keyword">auto</span> global = turi::unity_global(&amp;fn_reg, &amp;class_reg);

  <span class="hljs-comment">// load the model from disk</span>
  <span class="hljs-keyword">auto</span> loaded_model = global.load_model(<span class="hljs-string">&quot;mushroom.tcmodel&quot;</span>);
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> name = turi::variant_get_value&lt;turi::flexible_type&gt;(loaded_model[<span class="hljs-string">&quot;model_name&quot;</span>]);
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;Loaded model: &quot;</span> &lt;&lt; name &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
  <span class="hljs-keyword">auto</span> model = <span class="hljs-built_in">std</span>::dynamic_pointer_cast&lt;turi::supervised::xgboost::boosted_trees_classifier&gt;(
    turi::variant_get_value&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">shared_ptr</span>&lt;turi::model_base&gt;&gt;(loaded_model[<span class="hljs-string">&quot;model&quot;</span>])
  );

  <span class="hljs-comment">// set up input</span>
  <span class="hljs-comment">// (note: can do batch prediction by adding more than one row to rows)</span>
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;turi::flexible_type&gt; rows;
  turi::flex_dict row;
  row.push_back(<span class="hljs-built_in">std</span>::make_pair(<span class="hljs-string">&quot;bruises?&quot;</span>, <span class="hljs-string">&quot;t&quot;</span>));
  row.push_back(<span class="hljs-built_in">std</span>::make_pair(<span class="hljs-string">&quot;cap-color&quot;</span>, <span class="hljs-string">&quot;n&quot;</span>));
  row.push_back(<span class="hljs-built_in">std</span>::make_pair(<span class="hljs-string">&quot;cap-shape&quot;</span>, <span class="hljs-string">&quot;x&quot;</span>));
  row.push_back(<span class="hljs-built_in">std</span>::make_pair(<span class="hljs-string">&quot;cap-surface&quot;</span>, <span class="hljs-string">&quot;s&quot;</span>));
  row.push_back(<span class="hljs-built_in">std</span>::make_pair(<span class="hljs-string">&quot;gill-attachment&quot;</span>, <span class="hljs-string">&quot;f&quot;</span>));
  row.push_back(<span class="hljs-built_in">std</span>::make_pair(<span class="hljs-string">&quot;gill-color&quot;</span>, <span class="hljs-string">&quot;k&quot;</span>));
  row.push_back(<span class="hljs-built_in">std</span>::make_pair(<span class="hljs-string">&quot;gill-size&quot;</span>, <span class="hljs-string">&quot;n&quot;</span>));
  row.push_back(<span class="hljs-built_in">std</span>::make_pair(<span class="hljs-string">&quot;gill-spacing&quot;</span>, <span class="hljs-string">&quot;c&quot;</span>));
  row.push_back(<span class="hljs-built_in">std</span>::make_pair(<span class="hljs-string">&quot;habitat&quot;</span>, <span class="hljs-string">&quot;u&quot;</span>));
  row.push_back(<span class="hljs-built_in">std</span>::make_pair(<span class="hljs-string">&quot;odor&quot;</span>, <span class="hljs-string">&quot;p&quot;</span>));
  row.push_back(<span class="hljs-built_in">std</span>::make_pair(<span class="hljs-string">&quot;population&quot;</span>, <span class="hljs-string">&quot;s&quot;</span>));
  row.push_back(<span class="hljs-built_in">std</span>::make_pair(<span class="hljs-string">&quot;ring-number&quot;</span>, <span class="hljs-string">&quot;o&quot;</span>));
  row.push_back(<span class="hljs-built_in">std</span>::make_pair(<span class="hljs-string">&quot;ring-type&quot;</span>, <span class="hljs-string">&quot;p&quot;</span>));
  row.push_back(<span class="hljs-built_in">std</span>::make_pair(<span class="hljs-string">&quot;spore-print-color&quot;</span>, <span class="hljs-string">&quot;k&quot;</span>));
  row.push_back(<span class="hljs-built_in">std</span>::make_pair(<span class="hljs-string">&quot;stalk-color-above-ring&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>));
  row.push_back(<span class="hljs-built_in">std</span>::make_pair(<span class="hljs-string">&quot;stalk-color-below-ring&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>));
  row.push_back(<span class="hljs-built_in">std</span>::make_pair(<span class="hljs-string">&quot;stalk-root&quot;</span>, <span class="hljs-string">&quot;e&quot;</span>));
  row.push_back(<span class="hljs-built_in">std</span>::make_pair(<span class="hljs-string">&quot;stalk-shape&quot;</span>, <span class="hljs-string">&quot;e&quot;</span>));
  row.push_back(<span class="hljs-built_in">std</span>::make_pair(<span class="hljs-string">&quot;stalk-surface-above-ring&quot;</span>, <span class="hljs-string">&quot;s&quot;</span>));
  row.push_back(<span class="hljs-built_in">std</span>::make_pair(<span class="hljs-string">&quot;stalk-surface-below-ring&quot;</span>, <span class="hljs-string">&quot;s&quot;</span>));
  row.push_back(<span class="hljs-built_in">std</span>::make_pair(<span class="hljs-string">&quot;veil-color&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>));
  row.push_back(<span class="hljs-built_in">std</span>::make_pair(<span class="hljs-string">&quot;veil-type&quot;</span>, <span class="hljs-string">&quot;p&quot;</span>));
  rows.push_back(row);

  <span class="hljs-comment">// make prediction</span>
  turi::gl_sframe result = model-&gt;fast_predict_topk(
      <span class="hljs-comment">// input data - 1 row per prediction</span>
      rows,

      <span class="hljs-comment">// output type - see https://github.com/apple/turicreate/blob/3490286b27ff5d79cb90d09fe026d5671ce990c7/src/toolkits/supervised_learning/supervised_learning.hpp#L47</span>
      <span class="hljs-string">&quot;probability&quot;</span>,

      <span class="hljs-comment">// missing value action - see https://github.com/apple/turicreate/blob/3490286b27ff5d79cb90d09fe026d5671ce990c7/src/ml_data/ml_data_column_modes.hpp#L27</span>
      <span class="hljs-string">&quot;error&quot;</span>,

      <span class="hljs-comment">// k (returns top k predictions) -- must be &lt;= the number of classes</span>
      <span class="hljs-number">2</span>
  );
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> row_str = rows[<span class="hljs-number">0</span>].to&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt;(); <span class="hljs-comment">// turn first row of input into a string</span>
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;Input to model: &quot;</span> &lt;&lt; row_str &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;Predicted: &quot;</span> &lt;&lt; result &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
}</code></pre>
<p>And the output from C++ looks like:</p><pre><code>Loaded model: boosted_trees_classifier
Input to model: {&quot;bruises?&quot;:&quot;t&quot;, &quot;cap-color&quot;:&quot;n&quot;, &quot;cap-shape&quot;:&quot;x&quot;, &quot;cap-surface&quot;:&quot;s&quot;, &quot;gill-attachment&quot;:&quot;f&quot;, &quot;gill-color&quot;:&quot;k&quot;, &quot;gill-size&quot;:&quot;n&quot;, &quot;gill-spacing&quot;:&quot;c&quot;, &quot;habitat&quot;:&quot;u&quot;, &quot;odor&quot;:&quot;p&quot;, &quot;population&quot;:&quot;s&quot;, &quot;ring-number&quot;:&quot;o&quot;, &quot;ring-type&quot;:&quot;p&quot;, &quot;spore-print-color&quot;:&quot;k&quot;, &quot;stalk-color-above-ring&quot;:&quot;w&quot;, &quot;stalk-color-below-ring&quot;:&quot;w&quot;, &quot;stalk-root&quot;:&quot;e&quot;, &quot;stalk-shape&quot;:&quot;e&quot;, &quot;stalk-surface-above-ring&quot;:&quot;s&quot;, &quot;stalk-surface-below-ring&quot;:&quot;s&quot;, &quot;veil-color&quot;:&quot;w&quot;, &quot;veil-type&quot;:&quot;p&quot;}
Predicted: 
Columns:
    id    integer
    class    integer
    probability    float
Rows: 2
Data:
+----------------+----------------+----------------+
| id             | class          | probability    |
+----------------+----------------+----------------+
| 0              | 1              | 0.575584       |
| 0              | 0              | 0.424416       |
+----------------+----------------+----------------+
[2 rows x 3 columns]</code></pre>
<p>To build this C++ program, you&apos;ll need to borrow the compilation flags from Turi Create as shown above.</p><pre><code class="lang-shell"># run the following in the turicreate repository root:
./configure
cd release/src/unity
make -j8

# And assuming predict.cpp is in a sibling directory of turicreate, run:
c++ -std=c++11 -stdlib=libc++ -I../turicreate/src -I../turicreate/src/external -I../turicreate/src/platform -I../turicreate/deps/local/include -I../turicreate/src/external/armadillo/include -DHASH_FOR_UINT128_DEFINED -DHASH_FOR_INT128_DEFINED -L../turicreate/release/src/unity -lunity_shared predict.cpp ../turicreate/release/src/model_server/libunity.a
LD_LIBRARY_PATH=../turicreate/release/src/unity ./a.out</code></pre>
<h5 id="additional-resources"><a name="additional-resources" class="plugin-anchor" href="#additional-resources"><i class="fa fa-link" aria-hidden="true"></i></a>Additional Resources</h5><p>Please refer to the <a href="https://apple.github.io/turicreate/docs/cpp/" target="_blank">API documentation for the C++ API</a> for a more complete reference of available functions, classes, and methods.</p>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="conclusion.html" class="navigation navigation-prev " aria-label="Previous page: Additional Resources">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="datasets.html" class="navigation navigation-next " aria-label="Next page: Dataset Disclaimer">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"C++ API","level":"1.6.1","depth":2,"next":{"title":"Dataset Disclaimer","level":"1.6.2","depth":2,"path":"datasets.md","ref":"datasets.md","articles":[]},"previous":{"title":"Additional Resources","level":"1.6","depth":1,"path":"conclusion.md","ref":"conclusion.md","articles":[{"title":"C++ API","level":"1.6.1","depth":2,"path":"cpp.md","ref":"cpp.md","articles":[]},{"title":"Dataset Disclaimer","level":"1.6.2","depth":2,"path":"datasets.md","ref":"datasets.md","articles":[]}]},"dir":"ltr"},"config":{"gitbook":"3.2.0","theme":"default","variables":{},"plugins":["collapsible-menu@1.0.2","anchors@0.5.0","mathjax"],"pluginsConfig":{"collapsible-menu":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"fontSettings":{"theme":"white","family":"sans","size":2},"highlight":{},"mathjax":{"forceSVG":false,"version":"2.6-latest"},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"anchors":{}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"cpp.md","mtime":"2020-05-01T05:01:39.036Z","type":"markdown"},"gitbook":{"version":"3.2.0","time":"2020-08-27T01:03:37.520Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-collapsible-menu/plugin.js"></script>
        
    
        
        <script src="https://cdn.mathjax.org/mathjax/2.6-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-mathjax/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

